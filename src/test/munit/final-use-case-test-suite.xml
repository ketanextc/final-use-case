<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:batch="http://www.mulesoft.org/schema/mule/batch"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/batch http://www.mulesoft.org/schema/mule/batch/current/mule-batch.xsd 
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="final-use-case-test-suite.xml" />
	<munit:test name="final-use-case-test-suite-sftp-to-salesforce-flowTest" doc:id="23e3d1be-0d93-43d5-9b48-30f9337729de" description="Test">
		<munit:behavior >
		
			<munit-tools:mock-when doc:name="Mock List files from sftp" doc:id="64b3d764-cf64-4136-bd6f-75d1a93bc07b" processor="sftp:list">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="List files from sftp" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="8bb74d80-7006-41e3-8950-566c67e72e50" attributeName="doc:id" />
					<munit-tools:with-attribute whereValue="SFTP_Config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value="#[output application/json --- readUrl('classpath://mockData/list-files.dwl')]" mediaType="application/json" encoding="UTF-8" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock Read single zip file" doc:id="62a5179d-4703-482f-a4ba-28c2213d58b8" processor="sftp:read">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Read single zip file" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="5a3acc1f-2f6d-454c-b7df-a5172e8f7224" attributeName="doc:id" />
					<munit-tools:with-attribute whereValue="SFTP_Config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value="#[output application/json --- readUrl('classpath://mockData/Read-file.dwl')]" mediaType="application/json" encoding="UTF-8" />
					<munit-tools:variables >
						<munit-tools:variable key="filename" value="#[output application/json --- readUrl('classpath://mockData/filename-variable.dwl')]" mediaType="application/json" encoding="UTF-8" />
						<munit-tools:variable key="content" value="#[output application/json --- readUrl('classpath://mockData/content-variable.dwl')]" mediaType="application/zip" encoding="UTF-8" />
					</munit-tools:variables>
				</munit-tools:then-return>
			
</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock extract" doc:id="cdebd347-f2ba-4253-bc36-1387caa80c37" processor="compression:extract">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Extract zip content" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="8b9abc90-b9e0-4427-ac8f-fdcd7a382250" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value="#[output application/json --- readUrl('classpath://mockData\extract-payload.dwl')]" mediaType="application/json" encoding="UTF-8" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock Create" doc:id="a61b3e59-1bb9-4415-b1fa-ccd281b328d4" processor="salesforce:create">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Create" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="14e428e5-0541-490d-9642-7d8367ee53b8" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value="#[output application/json --- readUrl('classpath://mockData/create-payload.dwl')]" mediaType="application/java" encoding="UTF-8" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="Mock when" doc:id="5311e48e-9d39-48c4-be01-ebe74b6ecbf6" processor="sftp:move">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="Move processed files to another folder" attributeName="doc:name" />
					<munit-tools:with-attribute whereValue="68f8919a-a6a4-4bb0-b115-2d028da7782f" attributeName="doc:id" />
					<munit-tools:with-attribute whereValue="SFTP_Config" attributeName="config-ref" />
				</munit-tools:with-attributes>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >

			<flow-ref doc:name="Flow-ref to sftp-to-salesforce-flow" doc:id="5fba9607-40e5-4b6c-8018-375ffeee59f3" name="sftp-to-salesforce-flow"/>
		</munit:execution>
		<munit:validation >
			<munit-tools:sleep time="10000" doc:name="Sleep" doc:id="2e2438fa-c925-4a60-bc6e-5fa268fb840d" />
		</munit:validation>
	</munit:test>


</mule>
